var hlat,hlng,country,state,city,addr,countryname,countryid,statename,stateid,cityname,cityid,mainmap,onemap,addr_verified=!1,property_id=0;function showMsg(t){$("#modalmsg").html(t),$("#msgdlg").show()}function awayMsg(t){$("#msgdlg").hide()}function showeditmap(t){property_id=t,$("#editform").show(),$(".editmapform").hide(),$(".editmapform").fadeOut("normal",function(){$(".editmapform").fadeIn()}),onemap=initializeMap("propmap"),$.ajax({type:"POST",url:"/ajaxhelper.aspx/getpropertydetailinfo",data:"{ propid:"+t+"}",contentType:"application/json; charset=utf-8",dataType:"json",success:processProperty,failure:function(t){console.log(t.d)}})}function processProperty(t){console.log(t.d);var e=t.d;countryname=e.Country,statename=e.StateProvince,cityname=e.City,getcountries(countryname);var o=e.loc_latlang,a=e.loc_logitude,i=setMarkers(onemap,o,a).getPosition();onemap.setCenter(i),$("#m_addr").val(HtmlDecoder(e.Address))}function getcountries(t){$.ajax({type:"POST",url:"/ajaxhelper.aspx/getcountryidlist",data:'{ cname:"'+t+'"}',contentType:"application/json; charset=utf-8",dataType:"json",success:processCountry,failure:function(t){console.log(t.d)}})}function processCountry(t){var e=t.d,o=e.length;$("#m_country").html("");for(var a=0;a<o;a++)$("#m_country").append($("<option></option>").attr("value",e[a].ID).text(e[a].Name));$("#m_country option").each(function(){if($(this).text()==countryname)return $(this).attr("selected","selected"),!1}),countryid=$("#m_country").val(),$("#m_othercity").hide(),getStates(countryid)}function getStates(t){$.ajax({type:"POST",url:"/ajaxhelper.aspx/getstatesidlist",data:"{ id:"+t+"}",contentType:"application/json; charset=utf-8",success:processStates,failure:function(t){console.log(t.d)}})}function processStates(t){var e=t.d,o=e.length;$("#m_state").html(""),$("#m_city").html("");for(var a=0;a<o;a++)$("#m_state").append($("<option></option>").attr("value",e[a].ID).text(e[a].Name));$("#m_state option").each(function(){if($(this).text()==statename)return $(this).attr("selected","selected"),!1}),stateid=$("#m_state").val(),$("#m_othercity").hide(),getCities(stateid)}function getCities(t){null!=t&&$.ajax({type:"POST",url:"/ajaxhelper.aspx/getcityidlist",data:'{ id:"'+t+'"}',contentType:"application/json; charset=utf-8",dataType:"json",success:processCities,failure:function(t){console.log(t.d)}})}function processCities(t){var e=t.d,o=e.length;$("#m_city").html("");for(var a=0;a<o;a++)$("#m_city").append($("<option></option>").attr("value",e[a].ID).text(e[a].Name));$("#m_city").append($("<option></option>").attr("value",0).text("I have the property in other city")),$("#m_city option").each(function(){if($(this).text()==cityname)return $(this).attr("selected","selected"),!1}),cityid=$("#m_city").val(),0==o&&$("#m_othercity").show()}function initialize(t){addAllmarkers(mainmap=initializeMap("map_canvas"))}function initializeMap(t){var e={center:new google.maps.LatLng(51.5,-.12),zoom:5,mapTypeId:google.maps.MapTypeId.ROADMAP};return new google.maps.Map(document.getElementById(t),e)}function getLocationDetails(t,e){addr_verified=!1;var o="https://maps.googleapis.com/maps/api/geocode/json?latlng="+t+","+e+"&sensor=false";$.ajax({url:o,success:function(o){if(o.results.length>0){for(var a="false",i=0;i<o.results.length;i++)if(locationDetails=o.results[i].formatted_address.toLowerCase(),console.log(o.results[i].formatted_address),parseInt(locationDetails.indexOf(country.toLowerCase()))>=0){a="true";break}"false"==a?showMsg("Incorrect "):(setMarkers(onemap,t,e),hlat=t,hlng=e,addr_verified=!0,showMsg("Correct"))}else console.log("No location available for provided details.")},failure:function(t){console.log("get location error"+t.d)}})}$(document).ready(function(){$(".btnaction").click(function(){showeditmap($(this).attr("data-target"))}),$(".mclose").click(function(){var t=$(this).attr("data-target");$("#"+t).hide()}),$("#cancel").click(function(){$(".editmapform").fadeOut("normal",function(){$("#editform").hide()})}),$("#m_othercity").hide(),$("#m_country").on("change",function(t){$("option:selected",this);var e=this.value;$("#m_othercity").hide(),addr_verified=!1,getStates(e)}),$("#m_state").on("change",function(t){$("option:selected",this);var e=this.value;addr_verified=!1,$("#m_othercity").hide(),getCities(e)}),$("#m_city").on("change",function(t){$("option:selected",this);cityid=this.value,addr_verified=!1,0==cityid?$("#m_othercity").show():$("#m_othercity").hide()}),$("#verify").click(function(){null!=cityid?(country=$("#m_country option:selected").text(),state=$("#m_state option:selected").text(),city=$("#m_city option:selected").text(),0==cityid&&(city=$("#m_othercity").val()),""!=(addr=$("#m_addr").val())?GetLocation(addr+", "+state+", "+country):showMsg("The address is not specified.")):showMsg("The city or state province name is not existed.")}),$("#update").click(function(){addr_verified?($("#hpropid").val(property_id),$("#hcityid").val(cityid),$("#hstateid").val(stateid),$("#hcity").val(city),$("#haddr").val(addr),$("#hlat").val(hlat),$("#hlng").val(hlng),$("form").submit()):showMsg("You have to verified the address of the property.")})}),initialize(gmarkers);var markers=[];function setMarkers(t,e,o){clearMarkers();var a=new google.maps.LatLng(e,o),i=new google.maps.Marker({position:a,map:t});return markers.push(i),i}function clearMarkers(){for(var t=0;t<markers.length;t++)markers[t].setMap(null);markers=[]}function GetLocation(t){addr_verified=!1,(new google.maps.Geocoder).geocode({address:t},function(t,e){if(e==google.maps.GeocoderStatus.OK){var o=t[0].geometry.location.lat(),a=t[0].geometry.location.lng(),i=setMarkers(onemap,o,a);hlat=o,hlng=a,addr_verified=!0;var n=i.getPosition();onemap.setCenter(n),showMsg("Verification of Address Success")}else console.log("Request failed."),showMsg("Verification of Address Failed")})}function addAllmarkers(t){var e=new google.maps.LatLngBounds;for(i=0;i<gmarkers.length;i++){var o=gmarkers[i],a=new google.maps.LatLng(o.lat,o.lng),n=new google.maps.Marker({position:a,map:t,title:o.title});e.extend(n.position),function(t,e){google.maps.event.addListener(t,"click",function(t){window.open(e.URL)})}(n,o)}google.maps.event.addListener(t,"zoom_changed",function(){zoomChangeBoundsListener=google.maps.event.addListener(t,"bounds_changed",function(t){this.getZoom()>9&&1==this.initialZoom&&(this.setZoom(9),this.initialZoom=!1),google.maps.event.removeListener(zoomChangeBoundsListener)})}),t.initialZoom=!0,t.fitBounds(e)}function HtmlDecoder(t){return(new DOMParser).parseFromString("<!doctype html><body>"+t,"text/html").body.textContent}